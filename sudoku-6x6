<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>6x6 Pearl Sudoku</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
:root {
  --bg-color: #dbe7e0;
  --grid-color: #b3d1c2;
  --button-color: #b3d1c2;
  --button-text: #000;
  --font-color: #000;
  --overlay-text: rgba(0,0,0,0.65);
  --selection-color: rgba(60, 90, 140, 0.35);
}

body {
  margin: 0;
  padding: 20px;
  font-family: 'Inter', sans-serif;
  background: var(--bg-color);
  color: var(--font-color);
  display: flex;
  justify-content: center;
}

.app {
  max-width: 360px;
  width: 100%;
}

/* TITLE */
.title {
  text-align: center;
  font-size: 22px;
  font-weight: 600;
  margin-bottom: 12px;
}

/* GRID WRAPPER */
.grid-wrapper {
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1;
  margin-bottom: 16px;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  grid-template-rows: repeat(6, 1fr);
  width: 100%;
  height: 100%;
  background: white;
  border: 2px solid var(--grid-color);
}

/* CELLS */
.cell {
  border: 1px solid var(--grid-color);
  display: flex;
  align-items: center;
  justify-content: center;
}

.cell.major-right {
  border-right: 3px solid var(--grid-color);
}
.cell.major-bottom {
  border-bottom: 3px solid var(--grid-color);
}

.cell img {
  width: 78%;
  height: 78%;
  object-fit: contain;
}

/* SELECTION */
.cell.selected {
  background: var(--selection-color);
}

/* OVERLAY MESSAGE */
.overlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 56px;
  font-weight: 600;
  letter-spacing: 1px;
  color: var(--overlay-text);
  text-align: center;
  opacity: 0;
  pointer-events: none;
  z-index: 10;
  transition: opacity 1.2s ease-in-out;
}

/* PALETTE */
.palette {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 8px;
  margin-bottom: 16px;
}

.palette img {
  width: 100%;
  aspect-ratio: 1 / 1;
  object-fit: contain;
  cursor: pointer;
}

/* BUTTONS */
.controls {
  display: flex;
  gap: 12px;
}

button {
  flex: 1;
  padding: 10px;
  font-family: 'Inter', sans-serif;
  font-size: 14px;
  border-radius: 10px;
  border: none;
  background: var(--button-color);
  color: var(--button-text);
  cursor: pointer;
}
</style>
</head>

<body>
<div class="app">

  <div class="title">Mind Body Magic - Easy</div>

  <div class="grid-wrapper">
    <div class="grid" id="grid"></div>
    <div class="overlay" id="overlayText"></div>
  </div>

  <div class="palette" id="palette"></div>

  <div class="controls">
    <button onclick="undo()">Undo</button>
    <button onclick="resetGrid()">Clear</button>
  </div>

</div>

<script>
const images = [
  null,
  "https://hkdgqdmxhtnxtcuqfovq.supabase.co/storage/v1/object/public/PlayImages/malabead-1.png",
  "https://hkdgqdmxhtnxtcuqfovq.supabase.co/storage/v1/object/public/PlayImages/malabead-2.png",
  "https://hkdgqdmxhtnxtcuqfovq.supabase.co/storage/v1/object/public/PlayImages/malabead-3.png",
  "https://hkdgqdmxhtnxtcuqfovq.supabase.co/storage/v1/object/public/PlayImages/malabead-4.png",
  "https://hkdgqdmxhtnxtcuqfovq.supabase.co/storage/v1/object/public/PlayImages/malabead-5.png",
  "https://hkdgqdmxhtnxtcuqfovq.supabase.co/storage/v1/object/public/PlayImages/malabead-6.png"
];

const startPuzzle = [
 [0,2,4,0,1,0],
 [3,0,5,6,2,0],
 [2,0,0,4,3,6],
 [0,3,0,2,5,0],
 [0,0,2,1,4,3],
 [1,0,0,0,6,2],
];

let puzzle = JSON.parse(JSON.stringify(startPuzzle));
let selectedCell = null;
let history = [];

const gridEl = document.getElementById("grid");
const paletteEl = document.getElementById("palette");
const overlay = document.getElementById("overlayText");

function buildGrid() {
  gridEl.innerHTML = "";
  puzzle.forEach((row, r) => {
    row.forEach((val, c) => {
      const cell = document.createElement("div");
      cell.className = "cell";
      // Major lines for 3x2 boxes (3 cols × 2 rows)
      if ((c + 1) % 3 === 0 && c !== 5) cell.classList.add("major-right");
      if ((r + 1) % 2 === 0 && r !== 5) cell.classList.add("major-bottom");

      if (val) {
        const img = document.createElement("img");
        img.src = images[val];
        cell.appendChild(img);
      } else {
        cell.addEventListener("click", () => selectCell(cell));
      }

      cell.dataset.row = r;
      cell.dataset.col = c;
      gridEl.appendChild(cell);
    });
  });
}

function buildPalette() {
  for (let i = 1; i <= 6; i++) {
    const img = document.createElement("img");
    img.src = images[i];
    img.onclick = () => placePearl(i);
    paletteEl.appendChild(img);
  }
}

function selectCell(cell) {
  document.querySelectorAll(".cell").forEach(c => c.classList.remove("selected"));
  cell.classList.add("selected");
  selectedCell = cell;
}

function placePearl(val) {
  if (!selectedCell) return;
  const r = selectedCell.dataset.row;
  const c = selectedCell.dataset.col;
  history.push(JSON.parse(JSON.stringify(puzzle)));
  puzzle[r][c] = val;
  buildGrid();
  checkCompletion();
}

function undo() {
  if (!history.length) return;
  const prev = history.pop();
  prev.forEach((row,r) => puzzle[r]=row);
  buildGrid();
}

function resetGrid() {
  puzzle = JSON.parse(JSON.stringify(startPuzzle));
  history = [];
  buildGrid();
}

function showOverlay(text) {
  overlay.textContent = text;
  overlay.style.opacity = 1;
  setTimeout(() => overlay.style.opacity = 0, 2400);
}

/* VALIDATION */
function isValidSet(arr) {
  const set = new Set(arr);
  return set.size === 6 && !arr.includes(0);
}

function checkCompletion() {
  if (puzzle.flat().includes(0)) return;

  // Rows
  for (let r=0;r<6;r++) {
    if (!isValidSet(puzzle[r])) { showOverlay("Please try again"); return; }
  }

  // Columns
  for (let c=0;c<6;c++) {
    const col = puzzle.map(row=>row[c]);
    if (!isValidSet(col)) { showOverlay("Please try again"); return; }
  }

  // 3x2 Boxes (3 cols × 2 rows)
  for (let br=0;br<2;br++) {       // box column start
    for (let bc=0; bc<3; bc++) {   // box row start
      const box = [];
      for (let r=bc*2; r<bc*2+2; r++) {
        for (let c=br*3; c<br*3+3; c++) {
          box.push(puzzle[r][c]);
        }
      }
      if (!isValidSet(box)) { showOverlay("Please try again"); return; }
    }
  }

  showOverlay("Completed");
}

buildGrid();
buildPalette();
</script>
</body>
</html>
